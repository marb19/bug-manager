<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Agregar plantilla - BUG MANAGER</title>
		<link rel="stylesheet" href="CSS/Style.css" type="text/css" media="screen" />
		<script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
		<script type="text/javascript" src="./js/jquery.validate.min.js"></script>
		<script type="text/javascript" src="./js/localization/messages_es.js"></script>
                <script type="text/javascript" src="./js/jquery.printElement.js"></script>
		<script>
			function goToUrl(url)
			{
				window.location = url;
			}
                        function confirmErase(templateElementId, templateId)
                        {
                            if (confirm("¿Estás seguro que deseas borrar el elemento?"))
                            {
                                window.location = "deleteTemplateElement.do?templateElementId=" + templateElementId + "&templateId=" + templateId;
                            }
                            else
                            {
                                return false;
                            }
                        }
                        
                        $(document).ready(function(){

                            $('#toPrint').hide();
                            
                            $("#printTemplate").click(function() {
                                printElem({});
                            });

                            
                        });
                        
                        function printElem(options){
                            $('#toPrint').show().printElement(options);
                            $('#toPrint').hide();
                        }
		</script>
    </head>
	<body>
		<div id="header">
			<img src="images/Login/bm-logo.png"  alt="BM logo" id="base-bmlogo"/>
			<div id="base-header-text">
				Hoy es $dateLong.format($date.systemDate)<br/>
				Bienvenido, ${user.fullName}<br/>
				<a href='userLogin.do?op=logout'>Salir</a>
			</div>
			<div id="base-menu-bar">
                            <ul id="nav-bar">
                                <li><a href="listProjects.do">Proyectos</a></li>
                                <li><a href="listReports.do">Reportes</a></li>
                                #if($user.administrator)
                                <li><a href="listUsers.do">Usuarios</a></li>
                                #end
                                <li><a href="listTemplates.do">Plantillas</a></li>
                                <li><a href="listDefectTypes.do">Tipos de defectos</a></li>
                            </ul>
                        </div>
		</div>
		<div id="content"> <!--AQUI METER TODOS LOS INPUT, LABELS etc-->
			<div id="user">
				<form action="modifyTemplate.do" method="POST" id="user-add-form">
					<h3 id="form-title">Modificar Plantilla</h3>
					<table id="template-modify">
						<tr>
							<td colspan='2' class="explanatory-note-cell">
								<span class="explanatory-note">
									Datos de la plantilla:
								</span>
							</td>
						</tr>
						<tr>
							<td>
								<label for ="templateName" id="fullNameLabel">Nombre:</label>
							</td>
							<td>
                                                                #if($user.userName==$t.assignedUser.userName)
								<input type="text" name="templateName" id="templateName" value="${t.templateName}" class="required" />
                                                                #else
                                                                <input type="text" name="templateName" id="templateName" value="${t.templateName}" class="required" disabled="disabled" />
                                                                #end
							</td>
						</tr>
						<tr>
							<td>
								<label for ="text" id="templateDescription">Descripcion:</label>
							</td>
							<td>
                                                                #if($user.userName==$t.assignedUser.userName)
								<input type="text" name="templateDescription" id="templateDescription" value="${t.templateDescription}" class="required" />
                                                                #else
                                                                <input type="text" name="templateDescription" id="templateDescription" value="${t.templateDescription}" class="required" disabled="disabled" />
                                                                #end
							</td>
						</tr>
                                                <tr>
                                                    <td>
                                                        <label for ="templateReviewType" id="templateReviewTypeLabel">Tipo:</label>
                                                    </td>
                                                    <td>
                                                        #if($user.userName==$t.assignedUser.userName)
                                                        <select name="templateReviewType" id="templateReviewType" class="required">
                                                            #foreach($type in $templateReviewTypes)
                                                            #if($t.templateReviewType == $type)
                                                            <option value="${type}" selected="selected">${type}</option>
                                                            #else
                                                            <option value="${type}">${type}</option>
                                                            #end
                                                            #end
                                                        </select>
                                                        #else
                                                        <select name="templateReviewType" id="templateReviewType" class="required" disabled="disabled">
                                                            #foreach($type in $templateReviewTypes)
                                                            #if($t.templateReviewType == $type)
                                                            <option value="${type}" selected="selected">${type}</option>
                                                            #else
                                                            <option value="${type}">${type}</option>
                                                            #end
                                                            #end
                                                        </select>
                                                        #end
                                                    </td>
                                                </tr>
                                                #if($user.permissions>=20)
                                                <tr>
							<td>
								<label for ="templatePublic" id="templatePublic">Plantilla publica:</label>
							</td>
							<td>
                                                            #if($user.userName==$t.assignedUser.userName)
                                                                #if($t.templatePublic)
								<input type="checkbox" name="templatePublic" id="templatePublic" checked="true" value="true"/>
                                                                #else
                                                                <input type="checkbox" name="templatePublic" id="templatePublic" value="true"/>
                                                                #end
                                                            #else
                                                                #if($t.templatePublic)
								<input type="checkbox" name="templatePublic" id="templatePublic" checked="true" value="true" disabled="disabled"/>
                                                                #else
                                                                <input type="checkbox" name="templatePublic" id="templatePublic" value="true" disabled="disabled"/>
                                                                #end
                                                            #end
							</td>
						</tr>
                                                #else
                                                <input type="hidden" name="templatePublic" value="false"></input>
                                                #end
                                                <tr>
                                                        <td>
                                                            #if($user.userName==$t.assignedUser.userName)
                                                                <a href="newTemplateElement.do?templateId=${t.templateId}" id="add-element">Añadir elemento</a>
                                                            #end
                                                        </td>
                                                        <td>
                                                            
                                                        </td>
                                                </tr>
						<tr>
							<td><a href="listTemplates.do" id="cancel-link">Cancelar</a></td>
							<td>
                                                                <input type="hidden" name="templateId" value="${t.templateId}"></input>
                                                                <input type="hidden" name="assignedUser" value="${user.userName}"></input>
                                                                #if($user.userName==$t.assignedUser.userName)
								<input type="image" value="Aceptar" src="images/Base/aceptar.png" id="accept-button" />
                                                                #end
							</td>
						</tr>
					</table>
                                        #if ($elements.empty)
                                            <h3 id="form-title">Plantilla vacia.</h3>
                                        #else
                                        <input type="button" value="Imprimir Plantilla" id="printTemplate" name="printTemplate"/>
                                        <div id="table" name="table">
                                            <table id="content-table">
                                                <tr>
                                                    <th>Categoria</th>
                                                    <th>Descripcion</th>
                                                    <th colspan="2">Acciones</th>
                                                </tr>
                                                #foreach($e in $elements)
                                                <tr>
                                                    <td>${e.defectTypeName}</td>
                                                    <td>${e.elementDescription}</td>
                                                    #if($user.userName==$t.assignedUser.userName)
                                                    <td><a href="modifyTemplateElement.do?templateId=${e.templateId}&templateElementId=${e.elementId}">Modificar</a></td>
                                                    <td><a href="#" onclick="confirmErase('${e.elementId}', '${e.templateId}');">Borrar</a></td>
                                                    #end
                                                </tr>
                                                #end
                                            </table>
                                        </div>

                                        <div id="toPrint" name="toPrint">
                                            <table id="content-table" border="1">
                                                <tr>
                                                    <th>Categoria</th>
                                                    <th>Descripcion</th>
                                                    <th></th>
                                                </tr>
                                                #foreach($e in $elements)
                                                <tr>
                                                    <td>${e.defectTypeName}</td>
                                                    <td>${e.elementDescription}</td>
                                                    <td>&nbsp&nbsp&nbsp&nbsp&nbsp</td>
                                                </tr>
                                                #end
                                            </table>
                                        </div>

                                        #end
				</form>
			</div>
		</div>
    </body>
</html>