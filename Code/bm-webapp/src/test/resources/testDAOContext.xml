<?xml version="1.0" encoding="UTF-8"?>
<!-- * ***********************************************************************
 *   Copyright (c) 2010 BIPOLAR
 *   Confidential and Proprietary
 *   All Rights Reserved
 *
 * @(#)$Id: testDAOContext.xml 269 2010-10-23 19:59:04Z alex.vc@gmail.com $
 * Last Revised By   : $Author: alex.vc@gmail.com $
 * Last Checked In   : $Date: 2010-10-23 14:59:04 -0500 (Sat, 23 Oct 2010) $
 * Last Version      : $Revision: 269 $
 *
 * Original Author   : Alejandro Vazquez
 * Notes             :
 * *********************************************************************** -->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:ctx="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context-3.0.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx-3.0.xsd">

    <!-- activate load time weaving -->
    <ctx:load-time-weaver aspectj-weaving="on"/>
    <!-- Activate annotation-based bean configuration -->
    <ctx:annotation-config/>
    <ctx:spring-configured/>
    <!-- Activate annotation-based transactions -->
    <tx:annotation-driven mode="aspectj"/>

    <!-- Component scanning for business and DAO classes -->
    <ctx:component-scan base-package="mx.itesm.gda.bm.model.dao.impl"/>
    <ctx:component-scan base-package="mx.itesm.gda.bm.biz.impl"/>

    <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource"
          destroy-method="close">
        <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
        <property name="url" value="jdbc:mysql://localhost/bm"/>
        <property name="username" value="root"/>
        <property name="password" value=""/>
        <property name="initialSize" value="1"/>
        <property name="maxActive" value="20"/>
        <property name="maxIdle" value="1"/>
        <property name="maxWait" value="1000"/>
        <property name="minEvictableIdleTimeMillis" value="100"/>
        <property name="minIdle" value="1"/>
        <property name="timeBetweenEvictionRunsMillis" value="1000"/>
    </bean>

    <bean id="entityManagerFactory"
          class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
        <property name="dataSource" ref="dataSource"/>
        <property name="persistenceUnitName" value="bm-punit"/>
        <property name="persistenceProvider">
            <bean class="org.hibernate.ejb.HibernatePersistence"/>
        </property>
        <property name="jpaProperties">
            <props>
                <prop key="hibernate.dialect">org.hibernate.dialect.MySQL5InnoDBDialect</prop>
                <prop key="hibernate.cache.provider_class">org.hibernate.cache.HashtableCacheProvider</prop>
                <prop key="hibernate.hbm2ddl.auto">update</prop>
                <prop key="hibernate.connection.release_mode">after_transaction</prop>
            </props>
        </property>
    </bean>

    <bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
        <property name="entityManagerFactory" ref="entityManagerFactory"/>
        <property name="nestedTransactionAllowed" value="true"/>
        <property name="jpaDialect">
            <bean class="org.springframework.orm.jpa.vendor.HibernateJpaDialect"/>
        </property>
    </bean>

    <bean id="localeResolver" class="org.springframework.web.servlet.i18n.SessionLocaleResolver">
        <property name="defaultLocale">
            <bean class="java.util.Locale">
                <constructor-arg value="es"/>
                <constructor-arg value="MX"/>
            </bean>
        </property>
    </bean>

    <bean id="messageSource" class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
        <property name="basename" value="messages"/>
        <property name="useCodeAsDefaultMessage" value="true"/>
    </bean>

    <bean class="org.springframework.context.support.MessageSourceAccessor"
          autowire="constructor"/>

    <bean id="velocityEngine" class="org.springframework.ui.velocity.VelocityEngineFactoryBean">
        <property name="preferFileSystemAccess" value="false"/>
        <property name="resourceLoaderPath" value="/"/>
        <property name="velocityProperties">
            <value>
                input.encoding=UTF-8
                output.encoding=UTF-8
            </value>
        </property>
    </bean>

    <bean class="org.apache.velocity.tools.ToolManager"/>

    <bean class="java.security.SecureRandom" factory-method="getInstance">
        <constructor-arg value="SHA1PRNG"/>
    </bean>

    <bean class="mx.itesm.gda.bm.biz.UserAccessBizConfig">
        <property name="recoveryMailFrom" value="no-reply@bipolar.mx"/>
        <property name="recoveryLinkMailTemplate" value="emails/linkTemplate.vm"/>
        <property name="recoveryNewPasswordMailTemplate" value="emails/newPasswordTemplate.vm"/>
    </bean>

    <bean class="org.springframework.mail.javamail.JavaMailSenderImpl">
        <property name="defaultEncoding" value="UTF-8"/>
        <property name="host" value="localhost"/>
        <property name="port" value="25025"/>
    </bean>

    <bean class="org.springframework.mock.web.MockHttpServletRequest">
        <constructor-arg>
            <bean class="org.springframework.mock.web.MockServletContext">
                <constructor-arg value="http://localhost:8080/bm"/>
            </bean>
        </constructor-arg>
        <constructor-arg value="GET"/>
        <constructor-arg value="/whatever.do"/>
    </bean>

</beans>
